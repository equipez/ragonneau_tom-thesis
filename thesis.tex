% !TeX program = XeTeX
% !TeX encoding = utf-8
% !TeX spellcheck = en-US
%% thesis.tex
%% Copyright 2021-2022 Tom M. Ragonneau
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
%
% This work has the LPPL maintenance status `maintained'.
%
% The Current Maintainer of this work is Tom M. Ragonneau.
\documentclass[11pt]{book}
\usepackage[
    a4paper,
    nohead,
    includefoot,
    includemp,
    bindingoffset=0.5cm,
    top=2.25cm,
    left=3.75cm,
    right=0.75cm,
    bottom=1.5cm,
    marginparwidth=1.75cm,
    marginparsep=10pt,
    footskip=2cm,
]{geometry}
\usepackage[dvipsnames]{xcolor}
\usepackage[american]{babel}
\usepackage[strict]{csquotes}
\usepackage{emptypage}
\usepackage{tocbibind}
\usepackage{microtype}
\usepackage{nameref}
\usepackage{titling}
\usepackage{morewrites}

% Latin and Chinese fonts
\usepackage[T1]{fontenc}
\usepackage{fontspec}
\usepackage{xeCJK}
\newfontfamily{\regularheader}[
    Path=fonts/Roboto/,
    Extension=.ttf,
    UprightFont=*-Regular,
    BoldFont=*-Bold,
    ItalicFont=*-Italic,
    BoldItalicFont=*-BoldItalic,
]{Roboto}
\setmainfont{TeX Gyre Pagella}
\setCJKmainfont[
    Path=fonts/NotoSerifTC/,
    Extension=.otf,
    UprightFont=*-Regular,
    BoldFont=*-Bold,
]{NotoSerifTC}
\setCJKmonofont[
    Path=fonts/NotoSerifTC/,
    Extension=.otf,
]{NotoSerifTC-Regular}

% Page headers and footers
\usepackage{fancyhdr}
\pagestyle{fancy}
\renewcommand*{\chaptermark}[1]{\markboth{\textbf{\chaptername\ \thechapter\quad}\color{NavyBlue}#1}{}}
\renewcommand*{\sectionmark}[1]{\markright{\textbf{\thesection}\quad\color{NavyBlue}#1}}
\fancypagestyle{plain}{
    \fancyhf{}
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0pt}
    \fancyfootoffset[OR]{1.85cm}
    \fancyfoot[OR]{
        \ \regularheader{\color{NavyBlue}\rule[-90pt]{1.25pt}{100pt}}\hspace*{10pt}%
        \begin{minipage}[b]{1.5cm}
            \normalsize\textbf{\thepage}
        \end{minipage}%
    }
    \fancyfootoffset[EL]{1.85cm}
    \fancyfoot[EL]{
        \regularheader
        \begin{minipage}[b]{1.5cm}
            \raggedleft\normalsize\textbf{\thepage}
        \end{minipage}%
        \hspace*{10pt}{\color{NavyBlue}\rule[-90pt]{1.25pt}{100pt}}%
    }
}
\fancypagestyle{main}{
    \pagestyle{plain}
    \fancyhf{}
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0pt}
    \fancyfootoffset[OR]{1.85cm}
    \fancyfoot[OR]{
        \ \regularheader\footnotesize\rightmark\hspace*{1pc}{\color{NavyBlue}\rule[-90pt]{1.25pt}{100pt}}\hspace*{10pt}%
        \begin{minipage}[b]{1.5cm}
            \normalsize\textbf{\thepage}
        \end{minipage}%
    }
    \fancyfootoffset[EL]{1.85cm}
    \fancyfoot[EL]{
        \regularheader\footnotesize
        \begin{minipage}[b]{1.5cm}
            \raggedleft\normalsize\textbf{\thepage}
        \end{minipage}%
        \hspace*{10pt}{\color{NavyBlue}\rule[-90pt]{1.25pt}{100pt}}\hspace*{1pc}\leftmark%
    }
}
\pagestyle{main}

% Titles and sectioning
\usepackage[explicit]{titlesec}
\titleformat{\chapter}[display]
    {\normalfont\regularheader}
    {\vspace{-8em}\raggedleft\color{NavyBlue}{\rule[-5pt]{2pt}{5cm}\quad\fontsize{60}{60}\selectfont\thechapter}}
    {-2.1em}
    {\parbox[t]{\dimexpr\textwidth-4em\relax}{\raggedright\huge#1}}[\phantomsection]
\titlespacing*{\chapter}{0pt}{0pt}{3em}
\titleformat{\section}
    {\normalfont\regularheader\Large}
    {\thesection}
    {1pc}
    {\color{NavyBlue}#1}[\phantomsection]
\titleformat{\subsection}
    {\normalfont\regularheader\large}
    {\thesubsection}
    {1pc}
    {\color{NavyBlue}#1}[\phantomsection]

% List of hyphenation exceptions for US English
% Source: https://ctan.org/tex-archive/info/digests/tugboat/hyphenex
\input{ushyphex}

% Spacing between lines
% The Hong Kong Polytechnic University imposes a space of 1.5 or 2
\usepackage{setspace}
\onehalfspacing

% Customize list environments
\usepackage{enumitem}
\setitemize{
    topsep=\parsep,
    itemsep=0pt,
}
\setenumerate{
    topsep=\parsep,
    itemsep=0pt,
}

% Mathematical expressions
\input{utils/mathematics}

% Cross-referencing and colorization
% Note: hyperref must be imported after utils/mathematics.tex
\usepackage{hyperref}
\usepackage{url}
\hypersetup{
    colorlinks=true,
    linkcolor=OliveGreen,
    anchorcolor=black,
    citecolor=RedViolet,
    filecolor=black,
    menucolor=black,
    runcolor=black,
    urlcolor=black,
    linktoc=page,
}

% Automatic references
% Note: cleveref must be imported after hyperref
\usepackage[noabbrev]{cleveref}
\crefname{equation}{}{}
\Crefname{equation}{}{}

% Terms and acronyms processing
\usepackage[
    acronym,
    nopostdot=false,
    nogroupskip,
    indexonlyfirst,
]{glossaries-extra}
\setabbreviationstyle[acronym]{long-short}
\setglossarystyle{super}
\glssetcategoryattribute{\acronymtype}{glossdesc}{firstuc}
\glssetcategoryattribute{\acronymtype}{glossnamefont}{textbf}
\defglsentryfmt[main]{\texttt{\glsentrytext{\glslabel}}}
\renewcommand*{\glsfirstlongdefaultfont}[1]{\emph{#1}}
\makeglossaries
\glsdisablehyper
\loadglsentries{utils/glossary}

% Index processing
\usepackage{makeidx}
\usepackage[columns=2,totoc]{idxlayout}
\newcommand{\tb}[1]{#1\kern.15em t}  % indicates a table
\newcommand{\fb}[1]{#1\kern.15em f}  % indicates a figure
\newcommand{\nb}[1]{#1\kern.15em n}  % indicates a footnote
\makeindex

% Nomenclature processing
\usepackage[refpage,nocfg,intoc]{nomencl}
\setlength{\nomitemsep}{-\parsep}
\makenomenclature

% Environments for writing algorithms
\usepackage[
    ruled,
    algochapter,
    dotocloa,
    lined,
    longend,
    linesnumbered,
]{algorithm2e}

% Enhanced support for graphics
\usepackage{graphicx}

% Bibliography information processing
\usepackage[
    style=numeric-comp,
    sorting=nyt,
    sortcites,
    backref,
    backrefstyle=three,
]{biblatex}
\DefineBibliographyStrings{american}{
    backrefpage={Cited on p.},
    backrefpages={Cited on pp.},
}
\defbibheading{bibintoc}[\bibname]{
    \chapter*{#1}
    \addcontentsline{toc}{chapter}{#1}
    \markboth{#1}{#1}
}
\addbibresource{ragonneau-bib/strings.bib}
\addbibresource{ragonneau-bib/optim.bib}

% Thesis metadata
\usepackage[en-US]{datetime2}
\title{Model-Based Derivative-Free Optimization Methods and Software}
\author{Tom M. Ragonneau}
\DTMsavedate{ini}{2022-04-01}  % date of creation
\DTMsavedate{rev}{2022-09-01}  % date of revision
\date{\DTMusedate{ini}}
\def\degree{Doctor of Philosophy}
\def\university{The Hong Kong Polytechnic University}
\def\department{Department of Applied Mathematics}
\hypersetup{
    pdftitle=\thetitle,
    pdfauthor=\theauthor,
    pdfsubject={},
    pdfkeywords={},
}

\begin{document}

\frontmatter

\hypersetup{pageanchor=false}
\include{utils/coverpage}
\include{utils/typeset}
\include{utils/titlepage}
\hypersetup{pageanchor=true}

\include{utils/certificate}

\include{content/dedication}
\include{content/abstract}
\include{content/acknowledgments}

\cleardoublepage
\tableofcontents

\cleardoublepage
\listoffigures

\cleardoublepage
\listoftables

\cleardoublepage
\listofalgorithms

\cleardoublepage
\printglossary[type=\acronymtype]

\cleardoublepage
\include{utils/nomenclature}

\mainmatter

\include{content/introduction}
\include{content/method}
\include{content/conclusion}

\appendix

\cleardoublepage
\printbibliography[heading=bibintoc]

\cleardoublepage
\include{utils/index}

\end{document}
